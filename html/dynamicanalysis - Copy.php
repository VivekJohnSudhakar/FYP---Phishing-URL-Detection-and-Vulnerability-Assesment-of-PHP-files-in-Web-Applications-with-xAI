<html>
  <head>
    <title>Vulnerability Analysis [Phase2]</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../js/script.js"></script>
    <script src="../index.js"></script>
    <link href="../css/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="fixed-top">
      <nav class="navbar navbar-expand-lg navbar-dark mx-background-top-linear">
    <div class="container">
      <a class="navbar-brand" href="index.php" style="text-transform: uppercase;color:white"> VAPT of PHP code</a>
      <span style="font-size:20px;margin-top:8px;color:white;float:right">CEG,Anna University,Chennai</span>
    </div>
  </nav>
    </div>
    <div class="row">
      <div class="col-md-1">
      </div>
      <div class="col-md-5">
          <div class="panel panel-default">
          <div class="panel-heading text-center panel-relative"><b>File</b></div>
          <div class="panel-body">
          <pre data-lang='Source Code' class='prettyprint'>
             <?php
              $newfile = 'php_filecheck.txt';
                    echo "<xmp>".file_get_contents($newfile)."</xmp>";
              ?>
          </pre>
          </div>
          </div>
      </div>
          <div class="col-md-5">
          <div class="panel panel-default">
          <div class="panel-heading text-center panel-relative"><b>Static Code Analysis</b></div>
          <div class="panel-body">
            <div class="row">
              <div class="col-md-12">
                <ol class="breadcrumb breadcrumb-arrow">
                <li><a href="#" class="active_log">Sitemap</a></li>
                <li><a href="#"  >Static</a></li>
                <li><a href="#" id="active_link">Dyanmic</a></li>
                <li><a href="#">Ransomware</a></li>
                <li><a href="#">Report</a></li>
                <!--<li class="active"><span>Data</span></li>-->
                </ol>
              </div>
            </div>

            <div class="row">
<?php
        //$json = json_decode(file_get_contents("../html/ast.json"));
        //$count = 1;
		//Variables for the IVS attributes
		//$source_code = file_get_contents("../php_example2.php");

        $cookie_val = "NULL";
        $cookie_arr = 0;
        $database_val = "NULL";
        $database_arr = 0;
        $session_val = "NULL";
        $session_arr = 0;
//        $variable_val = "NULL";
//        $variable_arr = 0;
        $eval_val = "NULL";
        $eval_arr = 0;
        $numeric_val = "NULL";
        $numeric_arr = 0;
        $limtlen_val = "NULL";
        $limtlen_arr = 0;
//	    	$nun_val = "NULL";
//        $nun_arr = 0;
        $path_val = "NULL";
        $path_arr = 0;
        $encode_val = "NULL";
        $encode_arr = 0;
        $null_val = "NULL";
        $null_arr = 0;


		$special_val = "NULL";
		$special_arr = 0;
		$htmlentities = 0;
		$htmlentities_val = "NULL";
		$filter_var = 0;
		$filter_var_val = "NULL";
		$filter_input = 0;
		$filter_input_val = "NULL";
		$preg_replace = 0;
		$preg_replace_val = "NULL";
		$preg_match = 0;
		$preg_match_val = "NULL";
		$addslashes = 0;
		$addslashes_val = "NULL";
		$trim = 0;
		$trim_val = "NULL";
		$bind_param = 0;
		$bind_param_val = "NULL";
		$mysql_real_escape = 0;
		$mysql_real_escape_val = "NULL";

		$input_val = "NULL";
		$input_arr = 0;

		$file = fopen("../php_example.php","r");

		if($file == false)
		{
			echo "Error in opening file</br>";
		}
		else{
			while(!feof($file)){
				$source_code = fgets($file);
				$cookie_pos = strpos($source_code,'setcookie');
				$database_pos = strpos($source_code,'SELECT');
				$session_pos = strpos($source_code,'_SESSION');
//				$variable_pos = strpos($source_code,'variable');
				$eval_pos = strpos($source_code,'eval');
				$limitlen_pos = strpos($source_code,'substr');
				$path_pos = strpos($source_code,'scandir');
				$encode_pos = strpos($source_code,'utf8_encode');
				$nun_pos = strpos($source_code,'intval');
				$numeric_pos = strpos($source_code,'cast');
				$special_pos = strpos($source_code,'htmlspecialchars');
        $null_pos = strpos($source_code,'assertPurification');

				if(strpos($source_code,'_POST') != false){
					$input_val = "present";
					$input = 1;
				}

				if(strpos($source_code,'htmlentities') != false){
					$htmlentities = 1;
					$htmlentities_val = "Present";
				}
				if(strpos($source_code,'filter_var') != false){
					$filter_var = 1;
					$filter_var_val = "filter_var present";
				}
				if(strpos($source_code,'filter_input') !=false){
					$filter_input = 1;
					$filter_input_val = "filter_input present";
				}

				if(strpos($source_code,'preg_replace') != false){
					$preg_replace = 1;
					$preg_replace_val = "preg_replace present";
				}
				if(strpos($source_code,'preg_match') !=false){
					$preg_match = 1;
					$preg_match_val = "preg_match present";
				}
				if(strpos($source_code,'addslashes') != false){
					$addslashes = 1;
					$addslashes_val = "addslashes present";
				}
				if(strpos($source_code,'trim') != false){
					$trim = 1;
					$trim_val = "trim present";
				}
				if(strpos($source_code,'bind_param') !=false){
					$bind_param = 1;
					$bind_param_val = "bind_param present";
				}
				if(strpos($source_code,'mysql_real_escape_string') != false){
					$mysql_real_escape = 1;
					$mysql_real_escape_val = "mysql_real_escape_string present";
				}

				if($cookie_pos != false){
					$cookie_val = "Cookies Found";
					$cookie_arr = 1;
				}
				if($database_pos != false){
					$database_val = "Database Accessed";
					$database_arr = 1;
				}
				if($session_pos != false){
					$session_val = "Session Used";
					$session_arr = 1;
				}
				/*if($variable_pos != false){
					$variable_val = "Present";
				$variable_arr = 1;
				}
				*/
				if($eval_pos != false){
					$eval_val = "eval Present";
					$eval_arr = 1;
				}
				if($limitlen_pos != false){
					$limtlen_val = "String limiter Present";
					$limtlen_arr = 1;
				}
				if($path_pos != false){
					$path_val = "Path filter Present";
					$path_arr = 1;
				}
				if($encode_pos != false){
					$encode_val = "Encode using utf8_encode";
					$encode_arr = 1;
				}
				if($null_pos != false){
					$null_val = "Null filter present";
					$null_arr = 1;
				}
				if($nun_pos != false){
					$nun_val = "Numeric conversion present";
					$nun_arr = 1;
				}
				if($numeric_pos != false){
					$numeric_val = "Int Cast";
					$numeric_arr = 1;
				}
				if($special_pos != false){
					$special_val = "Special chars present";
					$special_arr = 1;
				}
			}
		}
	?>

  <div class="table-responsive" style="height:400px">
	<table class="table">
	<thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>File</td>
        <td><?php echo $cookie_val; ?></td>
      </tr>
      <tr>
        <td>2</td>
        <td>Database</td>
        <td><?php echo $database_val; ?></td>
      </tr>
            <tr>
        <td>3</td>
        <td>Session</td>
        <td><?php echo $session_val; ?></td>
      </tr>
           <!-- <tr>
        <td>4</td>
        <td>Uninit</td>
        <td><php echo $variable_val; ?></td>
      </tr>-->
            <tr>
        <td>4</td>
        <td>Known-vuln-std</td>
        <td><?php echo $eval_val; ?></td>
      </tr>
            <tr>
        <td>5</td>
        <td>Numeric</td>
        <td><?php echo $numeric_val; ?></td>
      </tr>

            <tr>
        <td>6</td>
        <td>Null-byte</td>
        <td><?php echo $null_val; ?></td>
      </tr>

            <tr>
        <td>7</td>
        <td>Encode</td>
        <td><?php echo $encode_val; ?></td>
      </tr>
            <tr>
        <td>8</td>
        <td>Path</td>
        <td><?php echo $path_val; ?></td>
      </tr>
        <tr>
        <td>9</td>
        <td>Limit-length</td>
        <td><?php echo $limtlen_val; ?></td>
      </tr>
	  <tr>
        <td>10</td>
        <td>Numeric Conversion</td>
        <td><?php echo $nun_val; ?></td>
      </tr>
	  <tr>
        <td>11</td>
        <td>Special Char</td>
        <td><?php echo $special_val; ?></td>
      </tr>

      <tr>
        <td>12</td>
        <td>is htmlentities() present</td>
        <td><?php echo $htmlentities_val; ?></td>
      </tr>
      <tr>
        <td>13</td>
        <td>is filter_var() present</td>
        <td><?php echo $filter_var_val; ?></td>
      </tr>
      <tr>
        <td>14</td>
        <td>is filter_input() present</td>
        <td
		<td><?php echo $filter_input_val; ?></td>
      </tr>
      <tr>
       <td>15</td>
        <td>is preg_replace() present</td>
        <td><?php echo $preg_replace_val; ?></td>
      </tr>
      <tr>
       <td>16</td>
        <td>is preg_match() present</td>
        <td><?php echo $preg_match_val; ?></td>
      </tr>
      <tr>
       <td>17</td>
        <td>is addslashes() present</td>
        <td><?php echo $addslashes_val; ?></td>
      </tr>
      <tr>
       <td>18</td>
	         <td>is trim() present</td>
        <td><?php echo $trim_val; ?></td>
      </tr>
      <tr>
       <td>19</td>
        <td>is bind_params() present</td>
        <td><?php echo $bind_param_val; ?></td>
      </tr>
      <tr>
       <td>20</td>
        <td>is mysql_real_escape_string() present</td>
        <td><?php echo $mysql_real_escape_val; ?></td>
      </tr>

    </tbody>
  </table>
  </div>
  </div>

<div class="row">
    <button type="button" class="btn btn-info" data-toggle="modal" style="float:left" data-target="#myModal">Vulnerability Analysis</button>
    <!--<a href="ransomwareanalysis.php"><button type="button" style="float:right" class="btn btn-primary">Rasomware Behavior Analysis</button></a>-->
</div>

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Analysis using Python</h4>
        </div>
        <div class="modal-body">
          <p>Array of attributes : [<?php echo $cookie_arr.','.$database_arr.','.$session_arr.','.$eval_arr.','.$numeric_arr.','.$null_arr.','.$encode_arr.','.$path_arr.','.$limtlen_arr.','.$nun_arr.','.$special_arr.','.$htmlentities.','.$filter_var.','.$filter_input.','.$preg_replace.','.$preg_match.','.$addslashes.','.$trim.','.$bind_param.','.$mysql_real_escape; ?>]</p>

          <p style="color:red">Make the array copied to the script</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>

          </div>
          </div>
      </div>
      <div class="col-md-1">
      </div>
    </div>
        <div class="fixed-bottom">
      <nav class="navbar navbar-expand-lg navbar-dark mx-background-bottom-linear">
    <div class="container">
      <a class="navbar-brand" href="../mainpage.php" style="text-transform: uppercase;"> 2021 CEG</a>
    </div>
  </nav>
    </div>
  </body>
</html>
