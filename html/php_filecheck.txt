<?php

  /* DevBug - PHP Static Code Analysis written (mostly) in JavaScript */

  // Cross-Site Scripting (XSS)
  $name = $_GET['name']; // tainted by user input
  echo('Hello ' . $name); # tainted data reaches sensitive sink

  // SQL Injection
  $id = $_POST['id'];
  $d = "SELECT * FROM users WHERE id = '$id'";
  mysql_query("SELECT user FROM users WHERE id = " . $id);

  // cookie access
  $cookie_name = "user";
  $cookie_Value = "Srimatii";
  setcookie($cookie_name, $cookie_value,time()+(86400*30),"/");

  // Command Injection
  $cmd = $_COOKIE['cmd'];
  exec("cat /var/log/apache2/access.log | grep " . $cmd);

  // Deprecated Function
  $words = split(":","split:this");

  //String limiter present
  $result = substr("Hello How are you", 0, 5);

  //Path filter present
  $dir = "/images/";
  $a = scandir($dir);
  $b = scandir($dir,1);

  print_r($a);
  print_r($b);

  //Encode using utf8_encode
  $text = "\xE0";
  $result = utf8_encode($text);

  //Eval present
  $string = "beautiful";
  $time = "winter";

  $str = 'This is a $string $time morning!';
  echo $str. "<br>";

  eval("\$str = \"$str\";");
  echo $str;

  //Session used
  $_SESSION["favcolor"] = "green";
  $_SESSION["favanimal"] = "cat";
  echo "Session variables are set.";

  $s = "Cricket is a 'religion' in <b>India</b>";
  htmlentities($s);
  echo htmlentities($s, ENT_QUOTES);

  htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
  //echo htmlentities($string, ENT_QUOTES, 'UTF-8');

  $email = "john.doe@example.com";
  if (filter_var($email, FILTER_VALIDATE_EMAIL)) {
    echo("$email is a valid email address");
  } else {
    echo("$email is not a valid email address");
  }

  $search_html = filter_input(INPUT_GET, 'search', FILTER_SANITIZE_SPECIAL_CHARS);
  echo "You have searched for $search_html.\n";

  $a = 32;
  echo "a is " . is_numeric($a) . "<br>";

  $data = $_POST['data'];
  $data = preg_replace('/[^a-z0-9 ]/i', '', $data);

  $str = "Visit W3Schools";
  $pattern = "/w3schools/i";
  echo preg_match($pattern, $str);

  $str = addslashes('What does "yolo" mean?');
  echo($str);

// bindParams prepared statements
  $conn = new mysqli($servername, $username, $password, $dbname);

  // Check connection
  if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
  }

  // prepare and bind
  $stmt = $conn->prepare("INSERT INTO MyGuests (firstname, lastname, email) VALUES (?, ?, ?)");
  $stmt->bind_param("sss", $firstname, $lastname, $email);

  // set parameters and execute - mysql_real_escape_string

  $firstname = mysql_real_escape_string("John");
  $lastname = "Doe";
  $email = mysql_real_escape_string("john@example.com");
  $stmt->execute();

  $str = "Hello World!";
  echo $str . "<br>";
  echo trim($str,"Hed!");

?>
